
  <!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Git," />





  <link rel="alternate" href="/atom.xml" title="Lucia" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="神奇的git rebase。">
<meta property="og:type" content="article">
<meta property="og:title" content="学习git rebase">
<meta property="og:url" content="http://lupeipei.github.io/posts/learn-git-rebase/index.html">
<meta property="og:site_name" content="Lucia">
<meta property="og:description" content="神奇的git rebase。">
<meta property="og:locale">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd7h2d0w9j30hc07tdfx.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd7rrxa4vj30g10683ym.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd7ywqkh0j30g604sglo.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd81284n1j30he04sq2y.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tNc79gy1frl89ao69gj30yk0f0whk.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdb6606a4j30ov07qtae.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdbrskqurj30hy0fktar.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdbworp60j30h503cwew.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdc1cpth8j30j8098ta8.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdc4xhyvtj30pc09o769.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdcefvmkdj30g4034wev.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdclnuardj30i5024aa7.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdcolt6gpj30p303h3z9.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdcw0a3f4j30hr03dmxl.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdd83pbc6j30r408wdi9.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsddapyuonj30pc04jmy2.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsddmig2w9j30ja04taas.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsddoiz6i9j30l206w754.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsddyiom7mj30p803saar.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsde56gortj30ib07haas.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsde96aeaxj30h202f3yo.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdeb2pe57j30p503f3z5.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdejlqhgtj30ka04774t.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdelazwpvj30p9030mxr.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdgn2vahrj30k401s0sv.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdgv7qw4lj30hk044q3h.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdgw5d060j30pb02adg5.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd964ruh1j30fo08waac.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd9gh66bej30fn04d74d.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd9grqz5dj30g805kweo.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd9qid4wyj30gl085jrt.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsda5p6fh0j30gl086wet.jpg">
<meta property="article:published_time" content="2018-06-18T01:01:57.000Z">
<meta property="article:modified_time" content="2019-06-08T04:21:03.000Z">
<meta property="article:author" content="Lucia">
<meta property="article:tag" content="Git">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd7h2d0w9j30hc07tdfx.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://lupeipei.github.io/posts/learn-git-rebase/"/>





  <title> 学习git rebase | Lucia </title>
<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Lucia</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-series">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-file-text"></i> <br />
            
            专题
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/posts/learn-git-rebase/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                学习git rebase
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-18T09:01:57+08:00">
                2018-06-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>2.9k words</span>
            </span>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>神奇的git rebase。</p>
<span id="more"></span> 

<h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>前段时间老大新教了一个技能，使用<code>git rebase master -i</code> 来修改或者合并commit，用了之后，顿时有种发现新世界的感觉，好工具有必要花时间了解下。</p>
<p>过了下<a target="_blank" rel="noopener" href="https://github.com/progit/progit2">pro git</a>，梳理下git rebase的基本使用以及“偷天换日”的神技。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><ul>
<li><p>基本用法</p>
<p>pro git中，对于basic rebase是这么说的：</p>
<blockquote>
<p>With the rebase command, you can take all the changes that were committed on one branch and replay them on another one.</p>
</blockquote>
<p>简单来说，就是相当于把一个分支A嫁接到另一个分支上B。</p>
<p>书中举了这么一个例子：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd7h2d0w9j30hc07tdfx.jpg"></p>
<p>现在需要将master 和experiment这两个分支合并。</p>
<p>有两种方式：</p>
<ul>
<li>merge</li>
<li>rebase</li>
</ul>
<p>先看merge，很简单，终端执行：</p>
<pre><code class="Shell">git checkout master ## 切到分支master
git merge experiment  ## 将experiment merge 到master
</code></pre>
<p>用three-merge  【我理解为三路合并】的方式来将两个最新的分支快照（C3和C4）和它们最近的共同祖先（C2）之间进行合并，创建了一个新的快照 C5。</p>
<p>效果：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd7rrxa4vj30g10683ym.jpg"></p>
<p>​</p>
<p>​</p>
<p>rebase的方式，终端执行：</p>
<pre><code class="Shell">git checkout experiment ## 切到分支experiment
git rebase master ## 将experiment嫁接到master上，即ancestor由原来的C2，变成了C3，生成了新的snapshot C4‘
git checkout master ## 切回到master
git merge experiment ## 将experiment merge进 master
</code></pre>
<p>效果：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd7ywqkh0j30g604sglo.jpg"></p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd81284n1j30he04sq2y.jpg"></p>
<p>这里你估计要嘀咕了，git rebase好像多走了两步啊。对，相比merge，它是多走了两步，但是这两步，让整个整合的过程变得很清晰，不同于three-merge的方式，而是直线式，先嫁接再简单的合并。而且你还可以选择，只rebase，不merge，什么意思呢？看下面一个很常见的场景：</p>
<blockquote>
<p>你在master上开了新的分支B1，同时其他人也开了分支B2，随后B2被merge进了 master，此时，你将分支push到远端代码仓库，对分支进行<code>git push -u origin B1</code>时，会显示有冲突，因为此时B1是基于本地的master来开发的，而远端origin因为已经merge了B2， 跟本地的master已经不同，怎么处理？</p>
</blockquote>
<p>思路也很清晰，先把远端最新的代码pull下来，让本地的master与origin/master同步，然后将B1 rebase 到同步后的master上即可。</p>
<p>终端执行：</p>
<pre><code class="Shell">git checkout master ## 切换到master
git pull origin master ## 拉下origin/master，让本地master与origin/master同步
git checkout B1 ## 切换到分支B1
git rebase master ## 将B1嫁接到master上，这样B1就是在最新的master上进行开发了，随后你push B1时，项目的maintainer就可以直接merge你的分支了
</code></pre>
<p>当然， rebase master的时候，可能会出现冲突问题，比如B2分支和你的B1同时修改了同一个地方，此时需要手动修正冲突，修改后，<code>git add</code>， 不用commit，然后<code>git rebase —continue</code>，直到没有冲突，完成rebase。</p>
<p>如果rebase仅仅只是这样，好像也没什么神奇的，下面才是重头戏。</p>
</li>
<li><p>偷天换日，篡改历史</p>
<p>执行如下命令，可以进入git rebase的interactive 交互模式 ：</p>
<pre><code>git rebase -i xxx
</code></pre>
<p>其中XXX指的是你要在哪个commit的基础上进行修改，也就是最后一个修改的commit的父commit，比如你现在在分支B上，想要rebase 分支B的最后3个，那就写：</p>
<pre><code>git rebase -i HEAD~3
</code></pre>
<p>这样rebase的时候，重新生成的commit history，就会是从HEAD, HEAD<del>1到HEAD</del>2的快照，而不会影响其它的snapshot。</p>
<p>同样，想要rebase 分支B的所有commit，假定B是从master主分支上开发的，则可以直接：</p>
<pre><code>git rebase -i master
</code></pre>
<p>进入到interactive 模式后， 可以看到目前有7个命令可以使用：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tNc79gy1frl89ao69gj30yk0f0whk.jpg"></p>
<p>简单过一下上面的命令列表：</p>
<ul>
<li>p, <code>pick</code> = 要这条 commit ，什麼都不改</li>
<li>r, <code>reword</code> = 要这条 commit ，但要改 commit message</li>
<li>e, <code>edit</code> = 要这条 commit，stop for  amending，不仅仅是edit message</li>
<li>s, <code>squash</code> = 要這條 commit，但要跟前面那条合并，合并后的message可以自己定义</li>
<li>f, <code>fixup</code> = 类似squash，但是不要这条 message，直接用前面的那条</li>
<li>e, <code>exec</code> = 使用shell执行指令</li>
<li>d, <code>drop</code> = 移除这条commit</li>
</ul>
<p>编辑好后，退出即可。</p>
<p>光说不练没什么感觉，找个项目练练。</p>
<p>假定现在有一个rails的项目movie，目前的commit history长这样：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdb6606a4j30ov07qtae.jpg"></p>
<p>我们把最后6个拎出来练练。</p>
<p>终端执行：</p>
<pre><code>git rebase -i HEAD~6
</code></pre>
<p>使用默认编辑器打开了git-rebase-todo：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdbrskqurj30hy0fktar.jpg"></p>
<p>我们修改一下commit “  implement like &amp; dislike movie “ ，把 &amp; 换成 and， 使用reword 命令试试。</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdbworp60j30h503cwew.jpg"></p>
<p>保存后退出，会打开COMMIT_EDITMSG， 我们将&amp;改成了and：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdc1cpth8j30j8098ta8.jpg"></p>
<p>保存后退出，打开fork，这时会发现最后6个commit的short SHA-1已经变了，生成了新的short SHA-1：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdc4xhyvtj30pc09o769.jpg"></p>
<p>看看edit:</p>
<p>同样的步骤，我们这次动 <strong>41e6c73</strong> implement my favorite movies, 把my 改成 users‘：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdcefvmkdj30g4034wev.jpg"></p>
<p>保存后退出，终端会输出如下的内容：</p>
<pre><code class="shell">Stopped at 41e6c73... implement my favorite movies
You can amend the commit now, with

    git commit --amend

Once you are satisfied with your changes, run

    git rebase --continue
</code></pre>
<p>按照指示来，执行<code>git commit --amend</code>, 在打开的编辑器中修改：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdclnuardj30i5024aa7.jpg"></p>
<p>保存后退出，执行<code>git rebase --continue </code>, 完成， 此时查看short SHA-1, 会发现，从刚刚修改的那条commit开始，又重新生成了新的short SHA-1。</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdcolt6gpj30p303h3z9.jpg"></p>
<p>这样看，edit 和reword好像没啥区别，额，你这可就小看edit了，修改message只是amending的一种哦，我们还可以使用edit来拆分commit。</p>
<p>比如我们来拆分 <strong>9d1e108</strong> implement like and dislike movie</p>
<p>还是一样的，在它前面添加e:</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdcw0a3f4j30hr03dmxl.jpg"></p>
<p>同样，保存后退出，回到命令行，我们reset下这个commit，将所有的文件从history里面捞出来，变成unstaged状态，然后再创建多个commit。终端执行：</p>
<pre><code>git reset HEAD~
git add app/controllers/movies_controller.rb
git commit -m &quot;add like and dislike actions&quot;
git add app/views/movies/show.html.erb
git commit -m &quot;add like and dislike button on movie&#39;s show page&quot;
git add config/routes.rb
git commit -m &quot;update routes for like and dislike actions&quot;
git rebase --continue
</code></pre>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdd83pbc6j30r408wdi9.jpg"></p>
<p>此时，一个commit被拆成了三个，short SHA-1也都更新了。</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsddapyuonj30pc04jmy2.jpg"></p>
<p>好，下一个，squash。</p>
<p>刚刚我们用<code>edit</code>拆了一个commit，现在我们使用<code>squash</code>把它们合并回来。</p>
<p>终端执行：</p>
<pre><code>git rebase -i HEAD~8
</code></pre>
<p>在<strong>bf9a37c</strong> 和<strong>66c0d7e</strong>前面的pick改成s:</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsddmig2w9j30ja04taas.jpg"></p>
<p>保存后退出，会打开COMMIT_EDITMSG:</p>
<p> <img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsddoiz6i9j30l206w754.jpg"></p>
<p>它会列出三个commit，如果你什么都不做，直接退出，它会自动将第2，3的commit合并到第一条，最后的commit message 变成：</p>
<blockquote>
<p>add method of like/dislike to movie</p>
<p>add like and dislike actions</p>
<p>add like and add like and dislike button on movie’s show page</p>
</blockquote>
<p>当然你也可以自己修改message，这里我们直接退出。</p>
<p>打开fork，会发现已经合并了，三个add 变成了一个add。【换行的缘故，没有显示全部的message】</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsddyiom7mj30p803saar.jpg"></p>
<p>​</p>
<p>额，我发现改错了，刚刚拆出来的不是这三条……擦，终端<code>git rebase -i HEAD~9 </code>了，把第9个commit给添加进来了……</p>
<p>正好，我们再来一次，把<strong>0d92196</strong>  add method of like/dislike to movie , **c2795c3 ** update  routes for like and dislike actions 合并， 这次换成自己定义新的commit message。</p>
<p>按照前面的方式再走一遍，在打开的COMMIT_EDITMSG中：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsde56gortj30ib07haas.jpg"></p>
<p>修改成：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsde96aeaxj30h202f3yo.jpg"></p>
<p>保存后退出，查看fork， 合并完成！</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdeb2pe57j30p503f3z5.jpg"></p>
<p>fixup类似squash，只是它是直接用前面一条commit，舍弃这一条，我们来试试。</p>
<p>对 <strong>b4062de</strong> use self delimit helper 进行fixup:</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdejlqhgtj30ka04774t.jpg"></p>
<p>保存后退出，rebase完成，查看fork：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdelazwpvj30p9030mxr.jpg"></p>
<p>刚刚的 <strong>b4062de</strong> use self delimit helper  已经被合并进了implement my reviews里面了，导致从implement my reviews 开始后的三个commit 的short SHA-1都更新了。【箭头画偏了……】</p>
<p>exec，运行命令：</p>
<p>在pro git中没有看到exec相关的例子，不过在这篇文章<a target="_blank" rel="noopener" href="http://kamalmarhubi.com/blog/2016/03/08/git-rebase-exec-make-sure-your-tests-pass-at-each-commit-and-other-rebase-goodies/">git rebase –exec: make sure your tests pass at each commit! (and other rebase goodies)</a>里面看到相关的操作, 照着试试。</p>
<p>选择<strong>9996f59</strong> render partial with collection， 我们添加上exec。</p>
<p>终端执行：</p>
<pre><code>git rebase -i --exec &quot;pwd&quot; 9996f59
</code></pre>
<p>会在<strong>9996f59</strong>后执行 pwd 命令，可以看到已经执行了pwd命令：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdgn2vahrj30k401s0sv.jpg"></p>
<p>额，Google上exec相关的内容还是较少的，少有的几篇说到了测试与重置authors的：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://til.hashrocket.com/posts/2839b35a3b-execute-a-shell-command-on-every-commit-in-rebase">Execute a shell command on every commit in rebase</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/21560896/how-to-run-tests-for-all-commits-during-a-rebase">How to run tests for all commits during a rebase</a></li>
</ul>
<p>d，移除commit：</p>
<p>终端执行：</p>
<pre><code>git rebase -i HEAD-6
</code></pre>
<p>删除最后一条 <strong>bac0634</strong>：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdgv7qw4lj30hk044q3h.jpg"></p>
<p>保存后退出， 查看fork：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsdgw5d060j30pb02adg5.jpg"></p>
<p>最后一条commit已经被移除了。</p>
</li>
</ul>
<ul>
<li><p>Rebase的危险性</p>
<p>rebase也不是想rebase就rebase的，这么强大的权利，用的时候，要注意的。</p>
<p>用书中的一句话就是：<strong>Do not rebase commits that exist outside your repository.</strong></p>
<p>换句话说，在你的分支还没有push到远端代码仓库时，你想怎么rebase都可以，但是如果你的代码已经push到远端了，而且你的同事是在你的分支的基础上开发的，那么请不要使用rebase来刷你的存在感。因为你rebase后，他们需要重新pull下你提交的最新代码，此时你之前的commit history和rebase后的commit history会让他们生生抓狂的。</p>
<p>看个场景理解下：【偷懒，直接用书中的例子】</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd964ruh1j30fo08waac.jpg"></p>
<p>此时，远端的分支master指向snapshot C1。</p>
<p>本地你在teamone/master上开发后，commit了两次，history中有snapshot C2， C3。</p>
<p>随后，你的同事A merge了C4， C5，生成了新的snapshot C6，然后git push，提交了新的代码，将master指向了C6。</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd9gh66bej30fn04d74d.jpg"></p>
<p>那很显然，你需要把teamone/master的代码fetch下来，merge后继续开发。同样，按照three-merge方式，这时git会将C3，C6和C1三路合并，生成新的snapshot C7。</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd9grqz5dj30g805kweo.jpg"></p>
<p>不幸的是，你的同事针对之前提交的分支，进行了rebase的操作，将C4嫁接到C5上，生成了新的snapshot C4‘， 然后<code>git push —force</code> 强制push到了远端，等同于刷新了之前的commit history。然后你继续fetch，再merge。</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsd9qid4wyj30gl085jrt.jpg"></p>
<p>此时，git merge了C4‘， C7和C1，重新生成快照C8，这时C8中来自于C4‘中的commit history，会跟C7中的commit history有重合的部分，相当于存在两个C4，导致出现两个一模一样的commit。</p>
<p>书中在rebase your rebase 部分中，提到一个针对这种情况的解决方法，思路就是分辨出所有的snapshot中，哪些是你做的修改，哪些是你的同事做的，值得庆幸的是，git 帮我们处理了这种情况。</p>
<p>终端执行：</p>
<pre><code>git fetch
git rebase teamone/master
</code></pre>
<p>会得到这样的效果：</p>
<p><img src="https://raw.githubusercontent.com/Lupeipei/blogImages/master/images/006tKfTcly1fsda5p6fh0j30gl086wet.jpg"></p>
<p>相当于将C2，C3直接嫁接到C4‘上，生成了新的commit，厉害！不过这种方法的前提是C4与C4’需要是一样的snapshot。至于原因，书中这样说的：</p>
<blockquote>
<p>Otherwise the rebase won’t be able to tell that it’s a duplicate and will add another C4-like patch (which will probably fail to apply cleanly, since the changes would already be at least somewhat there).</p>
</blockquote>
<p>如果C4与C4’不一样的话，rebase 无法分辨出C4‘是不是一个复制的commit snapshot？额，这里暂时没有理解透。</p>
<p>不过个人看完的感觉就是，push后的分支，应当尽量避免使用rebase。</p>
</li>
<li><p>rebase VS merge</p>
<p>个人的理解，两者还是不一样的，merge类似把两个东西融为一体，而rebase 则好比进行重新嫁接。书中提到commit history的一个意义就在于记录下发生了什么，使用merge会真实的记录下所有发生的事情，而rebase，诚如上面做过的那些commands，有着篡改历史的嫌疑，但也有好处，可以把杂乱的commit history整理的清清爽爽，谁喜欢一个分支上一堆没什么用的commits呢。</p>
<p>借书中一段话作为结尾：</p>
<blockquote>
<p>In general the way to get the best of both worlds is to rebase local changes you’ve made but haven’t shared yet before you push them in order to clean up your story, but never rebase anything you’ve pushed somewhere.</p>
</blockquote>
</li>
</ul>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a target="_blank" rel="noopener" href="https://github.com/progit/progit2">pro git</a></p>
<p><a target="_blank" rel="noopener" href="http://kamalmarhubi.com/blog/2016/03/08/git-rebase-exec-make-sure-your-tests-pass-at-each-commit-and-other-rebase-goodies/">git rebase –exec: make sure your tests pass at each commit! (and other rebase goodies)</a></p>
<p><a target="_blank" rel="noopener" href="https://til.hashrocket.com/posts/2839b35a3b-execute-a-shell-command-on-every-commit-in-rebase">Execute a shell command on every commit in rebase</a></p>
<p>推荐阅读：<a target="_blank" rel="noopener" href="https://blog.yorkxin.org/2011/07/29/git-rebase">git rebase</a>， 写的很详细，类比也很形象。</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div class="reward-container">
    <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
      <span>赞赏支持</span>
    </button>
    <div id="qr" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wechat.png" alt=" WeChat Pay"/>
          <p>Wechat</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/alipay.png" alt=" Alipay"/>
          <p>Alipay</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Git/" rel="tag"># Git</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/film-back-to-back-face-to-face/" rel="next" title="观《背靠背，脸对脸》">
                <i class="fa fa-chevron-left"></i> 观《背靠背，脸对脸》
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/assign-attributes-with-accepts-nested-attributes-for/" rel="prev" title="Rails中的assign_attributes和accepts_nested_attributes_for">
                Rails中的assign_attributes和accepts_nested_attributes_for <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      

    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      
  <script src="https://utteranc.es/client.js"
    repo="Lupeipei/Lupeipei.github.io"
    issue-term="pathname"
    label="Comment"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>


    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="" />
          <p class="site-author-name" itemprop="name"></p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">308</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">64</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Lupeipei" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/luciaca27276337" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="nav-number">1.</span> <span class="nav-text">写在前面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A3%E6%96%87"><span class="nav-number">2.</span> <span class="nav-text">正文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">3.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lucia</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
  &nbsp; | &nbsp;
  <span class="post-count">
    <i class="fa fa-pencil" aria-hidden="true"></i>
    374.6k
  </span>

</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

  <link rel="stylesheet" type="text/css" href="/js/google-code-prettify/tomorrow-night-bright.min.css">
  <script type="text/javascript" src="/js/google-code-prettify/prettify.js"></script>
  <script type="text/javascript">
  $(window).load(function(){
     $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
     prettyPrint();
   })
  </script>
</body>
</html>



